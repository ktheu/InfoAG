<!DOCTYPE html>
<html><head>
    <meta name="viewport" width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
    <script src="p5.min.js"></script>
    <script>
        /*
         Ein Paddle wird mit den Pfeiltasten gesteuert. Der Ball prallt
         an den Seiten und oben ab. Wenn er vom Paddle abprallt erhöht sich
         seine Geschwindigkeit geringfügig und ein Zähler wird hochgezählt.
         */
        "use strict";
        var px, py;      // Koordinaten des Paddles
        var x, y;        // Koordinaten des Balls
        var vpx = 7;     // horizontale Geschwindigkeit des Paddles
        var vx = 5.0;    // x-Geschwindigkeit des Balls
        var vy = 5.0;    // y-Geschwindigkeit des Balls
        var radius = 10; // Radius des Balls
        var hoehePaddle = 10;
        var breitePaddle = 100;
        var tright = false; // Schalter Taste
        var tleft = false;  // Schalter Taste
        var treffer = 0;
        var debug = false;

        var p_ballOberhalbVonPaddle;
        var p_ballUnterhalbVonPaddle;
        var p_ballLinksVonPaddle;
        var p_ballRechtsVonPaddle;


        function setup() {
            createCanvas(500, 500);
            ellipseMode(RADIUS);
            textSize(20);
            x = width/2;          // Anfangsposition Ball
            y = 50;
            px = width/2-20;         // Anfangsposition Padde
            py = 0.9 * height;
        }

        function draw() {

            if (frameCount >= 78) {
                //debug = true;
            }


            // check -  move - display
            background(0);

            // check: Ball am Rand?
            if (x - radius < 0 || x + radius > width) vx = - vx;
            if (y - radius < 0 ) vy = - vy;

            // check: Ball kollidiert mit Paddle?
            var ballOberhalbPaddle = y + radius < py;
            var ballUnterhalbPaddle = y - radius > py+hoehePaddle;
            var ballLinksVonPaddle = x + radius < px;
            var ballRechtsVonPaddle = x - radius > px + breitePaddle;
            var kollision = !ballOberhalbPaddle && !ballUnterhalbPaddle &&
                !ballLinksVonPaddle && !ballRechtsVonPaddle;

            /*
            Hier werden die Variable kommtVonrechts vom vorherigen Durchlauf mit
            den neuen Kollisionsvariablen verglichen. Unschön: check und move sind gemischt. 
            Alternative: für jede Kollisionsvariable ein Exemplar für den
            vorherigen Zustand neu definieren.

            */

            if (kollision && !ballRechtsVonPaddle && p_ballRechtsVonPaddle) {
                vx = -vx;
                //vy = -vy;                // dies könnte man auch weglassen
            } else if (kollision) {
                vy = -1.05*vy;
                treffer++;
               // y = py - radius;       // einfacher Fix: Korrektur der y-Koordinate
            }

            // move: Bewegung des Paddles
            if (tright) px = px + vpx;
            if (tleft) px = px - vpx;

            // move: Bewegung des Balls
            x = x + vx;
            y = y + vy;

            // update previous Variables
            p_ballOberhalbVonPaddle = ballOberhalbPaddle;
            p_ballUnterhalbVonPaddle = ballUnterhalbPaddle;
            p_ballLinksVonPaddle = ballLinksVonPaddle;
            p_ballRechtsVonPaddle = ballRechtsVonPaddle;

            // display Paddle
            fill(120);
            rect(px, py, breitePaddle, hoehePaddle);

            // display Ball
            fill(255);
            noStroke();
            ellipse(x, y, radius, radius);

            // display Treffer
            text(treffer+"", 20, 30);

            if (debug) {
                debugInfo(kollision,ballOberhalbPaddle,ballRechtsVonPaddle);
                noLoop()
            }

        }

        function keyPressed() {
            if (keyCode == RIGHT_ARROW) tright = true;
            if (keyCode == LEFT_ARROW) tleft = true;
        }

        function keyReleased() {
            if (keyCode == RIGHT_ARROW) tright = false;
            if (keyCode == LEFT_ARROW) tleft = false;
        }

        function debugInfo(koll,boben,brechts) {
            var fr = " frame "+ frameCount;
            var sx =" x="+x;
            var sy =" y="+y.toFixed(1);
            var svy=" vy="+vy.toFixed(1);
            var svx=" vx="+vx;
            var skoll=" koll="+koll;
            var sboben = " oben= "+boben;
            var sbrechts = " rechts="+brechts;
            var zeile1 = fr+skoll;
            var zeile2 = sx+sy+svx+svy;
            var zeile3 = sboben+sbrechts

            textSize(10);
            text(zeile1+'\n'+zeile2+'\n'+zeile3,300,50);
        }

        function mousePressed() {
            loop();
        }


    </script>

</head><body></body></html>
