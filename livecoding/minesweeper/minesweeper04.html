<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
  <script>

    let rows = 8;
    let cols = 8;
    let grid = [];
    let groesse = 70;
    let bomb = String.fromCodePoint('0x1F4A3')

    function setup() {
      createCanvas(cols * groesse + 4, rows * groesse + 4);
      createGrid();
      createBombs(10);
    }

    function draw() {
      showGrid();
    }

    function showGrid() {
      for (let i = 0; i < cols; i++) {
        for (let j = 0; j < rows; j++) {
          grid[i][j].display();
        }
      }
    }

    function createGrid() {
      for (let i = 0; i < cols; i++) {
        grid[i] = [];
        for (let j = 0; j < rows; j++) {
          grid[i][j] = new Tile(i, j, groesse);
        }
      }
    }

    function countBombs(i, j) {
      let dirs = [[-1, -1], [0, -1], [1, -1], [-1, 0], [1, 0], [-1, 1], [0, 1], [1, 1]]
      let zaehl = 0;
      for (let c of dirs) {
        let x = i + c[0]
        let y = j + c[1]
        if (0 <= x && x < cols && 0 <= y && y < rows) {
          if (grid[x][y].zeichen === bomb) {
            zaehl += 1;
          }
        }
      }
      return zaehl;

    }


    function createBombs(n) {
      a = []
      wahl = []
      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          a.push([i, j])
        }
      }

      for (let j = 0; j < n; j++) {
        let w = floor(random(a.length));
        wahl.push(a[w])
        a.splice(w, 1);
      }

      for (let c of wahl) {
        grid[c[0]][c[1]].zeichen = bomb;
      }
    }

    // berechnet aus mouseX den i-Index der Kachel
    function I(x) {
      return Math.floor((x - 2) / groesse);
    }

    // berechnet aus mouseY den j-Index der Kachel
    function J(y) {
      return Math.floor((y - 2) / groesse);
    }

    function mousePressed() {
     
      let i = I(mouseX);
      let j = J(mouseY);
      grid[i][j].state = 1;
      if (key === '0') {
        grid[i][j].state = 0
      }
      else if (key === '1') {
        grid[i][j].state = 1
      }
      else if (key === '2') {
        grid[i][j].state = 2
      }
      grid[i][j].zeichen = countBombs(i, j).toString();
    }

    class Tile {

      constructor(i, j, groesse) {
        this.i = i;
        this.j = j;
        this.groesse = groesse;
        this.state = 0;  // 0 - zu, 1 - auf, 2 - markiert   
        this.zeichen = '';
      }

      display() {
        //  FFB03B,  468966,  FFF0A5 
        strokeWeight(3);
        switch (this.state) {
          case 0:
            fill('#FFB03B');
            break;
          case 1:
            fill('#FFF0A5');
            break;
          case 2:
            fill('#468966');
        }
        stroke('#8E2800')    // Farbe fÃ¼r den Kachel-Rand
        rect(2 + this.i * this.groesse, 2 + this.j * this.groesse, this.groesse, this.groesse);
        if (this.state <= 3) {
          this.inhalt();
        }
      }

      inhalt() {
        textAlign(CENTER, CENTER);
        textSize(this.groesse * 0.6);
        fill('#8E2800')
        text(this.zeichen, (this.i + 0.55) * this.groesse, (this.j + 0.6) * this.groesse);
      }
    }
  </script>
</head>

<body>
</body>

</html>