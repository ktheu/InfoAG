<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
    <script>

        let highscoreText = "";
        let hsmin = 0;    // minimaler Highscore
        let score = 0;
        let name = "";

        let state = "PLAY";

        function setup() {
            createCanvas(300, 200);
            getHighscore();
        }

        function getHighscore() {
            httpGet(
                "/highscore",
                "json",
                false,
                function (res) {
                    highscoreText = "Highscore:\n\n";
                    for (let i = 0; i < res.length; i++) {
                        highscoreText += res[i].name + ": " + res[i].score + "\n";
                    }
                    hsmin = res[res.length - 1].score;
                }
            );
        }

        function draw() {
            background(220);
            text(highscoreText, 50, 30);

            text("Deine Zahl: " + score, 50, 140);

            if (score > hsmin) {
                state = "EINGABE";
                text("Dein Name: " + name, 50, 165);
            }
        }

        function keyTyped() {
            if (state === "EINGABE") {
                name += key;
            }
        }

        function keyPressed() {
            if (state === "EINGABE") {
                if (keyCode === BACKSPACE) name = name.substr(0, name.length - 1);
                if (keyCode === ENTER) {
                    let data = {
                        name: name,
                        score: score
                    };
                    httpPost("/highscore", data, function (res) {
                        score = 0;
                        name = "";
                        state = "PLAY";
                        getHighscore();
                    });
                }
            }
        }

        function mousePressed() {
            if (state === "PLAY") {
                score = int(random(50));
            }
        }
    </script>
</head>

<body></body>

</html>