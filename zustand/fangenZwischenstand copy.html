<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
  <script>

    let farbe0 = ['#295B7F', '#89CEFF', '#52B7FF', '#3D88BE', '#737A7F'] // blue
    let farbe1 = ['#325C40', '#60E08B', '#3F8F59', '#367049', '#5A635D'] // green
    let basketbreite = [60, 50];
    let balldurchmesser = [30, 35];
    let vy = [2, 3];

    let farben = [farbe0, farbe1]
    let x; // Koordinaten des Balls
    let y;

    let state = "WELCOME";
    let level;
    let score;

    function setup() {
      createCanvas(400, 400);
      score = 0;
      newBall();
    }

    function draw() {

      switch (state) {
        case "WELCOME":
          welcome();
          break;
        case "PLAY":
          play(level);
          break;
        case "END":
          end();
          break;
      }
    }

    function newBall() {
      y = 0;
      x = int(random(50, width - 50));

    }

    function textausgabe(textinhalt, y, size, farbe) {
      rectMode(CORNER);
      fill(farbe);
      textSize(size);
      textAlign(CENTER);
      text(textinhalt, 0, y, width);
    }

    function welcome() {
      background(120);
      textausgabe("Welcome to Ballfangen", 100, 20, 200);
      textausgabe("Move the basket with the mouse to catch the ball", 200, 14, 200);
      textausgabe("Press enter to start", 220, 14, 200);
    }

    function play(lvl) {
      background(farben[lvl][0])
      // check
      let radius = balldurchmesser[lvl] / 2;
      let baskethalb = basketbreite[lvl] / 2;
      let oberhalb = (y + radius) < height - 50;
      let unterhalb = (height - 50) < y - radius
      let zwischen = (mouseX - baskethalb < x - radius) && (x + radius < mouseX + baskethalb);

      let gefangen = zwischen && unterhalb;

      if (gefangen) {
        score++;
        if (level === 1) {
          state = "END"
        } else {
          level++;
          newBall();
        }
      }

      // move
      y = y + vy[level]

      // display 
      displayScore(level);
      displayBasket(level);
      displayBall(level);
      if (zwischen) circle(0, 0, 50);
    }

    function displayBall(level) {
      fill(farben[level][4]);
      circle(x, y, balldurchmesser[level]);
    }

    function displayBasket(level) {
      rectMode(CENTER);
      fill(farben[level][3]);
      rect(mouseX, height - 25, basketbreite[level], 50);
    }

    function displayScore(level) {
      fill(farben[level][2]);
      textSize(20);
      text(score, 40, 40);
    }


    function end() {
      background(120);
      textausgabe("End of Ballfangen", 100, 20, 200);
      textausgabe("Press r to restart", 220, 14, 200);
    }

    function keyPressed() {
      if (state === 'WELCOME' && keyCode === ENTER) {
        level = 0;
        state = 'PLAY'
      } else if (state === 'PLAY' && keyCode === ENTER && level === 1) {
        state = 'END';
      } else if (state === 'END' && key === 'r') {
        state = 'PLAY';
        level = 0;
      }

    }

  </script>
</head>

<body>
</body>

</html>